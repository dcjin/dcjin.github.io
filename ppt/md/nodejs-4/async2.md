# 异步编程解决方案

`目前`，异步编程的主要解决方案有如下3中

- 事件发布/订阅模式
- Promise/Deferred模式
- 流程控制库

## 事件发布/订阅模式

### 在node中

- Node自身提供了`events`模块，通过`new events.EventEmitter()`来构建`EventEmitter`对象
- Node自身有近半数模块继承自`EventEmitter`，也有模块就是`EventEmitter`的实例

### 怎么用

```javascript
require('../../../test/nodejs/async');
```

### 优势

- 事件(API)本身和业务逻辑是解耦的，是一种典型的逻辑分离方式
- 可以轻松地添加、移除侦听器，业务可以轻松的做到关联和解耦
- 可以利用事件队列解决雪崩问题(once)
    - 所谓雪崩问题，就是在高访问量、大并发量的情况下缓存失效的情景，此时大量的请求同时涌入数据库中，数据库无法同时承受如此大的查询请求，进而往前影响到网站整体的响应速度。

### 难点

- 事件内部是应该对修改是关闭的，将容易变化的、自定义的部分暴露给外部处理，这对接口的设计有一定的要求。
- Node中对事件的侦听器有数量限制，过多的侦听器可能会对主线程有过多的CPU占用(可以通过API移除限制)
- 一个健壮的EE应该对error事件做处理
- 多异步之间的协作方案

## Promise/Deferred

。。。

## 流程控制库

。。。